<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>The luckiest investor or what if you knew the future? | Merely curious</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="The luckiest investor or what if you knew the future?" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Imagine that you have 1000 USD on the evening of 31st of December, 2017. In addition to that you happen to know daily prices of all US stocks in 2018. How much money could you make by taking into account the future and investing perfectly?" />
<meta property="og:description" content="Imagine that you have 1000 USD on the evening of 31st of December, 2017. In addition to that you happen to know daily prices of all US stocks in 2018. How much money could you make by taking into account the future and investing perfectly?" />
<link rel="canonical" href="https://merelycurious.me/post/luckiest-investor-or-investing-when-knowing-the-future" />
<meta property="og:url" content="https://merelycurious.me/post/luckiest-investor-or-investing-when-knowing-the-future" />
<meta property="og:site_name" content="Merely curious" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-05-19T07:00:00+02:00" />
<script type="application/ld+json">
{"description":"Imagine that you have 1000 USD on the evening of 31st of December, 2017. In addition to that you happen to know daily prices of all US stocks in 2018. How much money could you make by taking into account the future and investing perfectly?","@type":"BlogPosting","url":"https://merelycurious.me/post/luckiest-investor-or-investing-when-knowing-the-future","headline":"The luckiest investor or what if you knew the future?","dateModified":"2019-05-19T07:00:00+02:00","datePublished":"2019-05-19T07:00:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://merelycurious.me/post/luckiest-investor-or-investing-when-knowing-the-future"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://merelycurious.me/feed.xml" title="Merely curious" /><script>
if(!(window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1")) {
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-131503689-1', 'auto');
  ga('send', 'pageview');
}
</script>
  
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Merely curious</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/queue/">Future post ideas</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">The luckiest investor or what if you knew the future?</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2019-05-19T07:00:00+02:00" itemprop="datePublished">May 19, 2019
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Imagine that you have 1000 USD on the evening of 31st of December, 2017. In addition to that
you happen to know daily prices of all US stocks in 2018. How much money could
you make by taking into account the future and investing perfectly?</p>

<!--more-->

<h2 id="prelude">Prelude</h2>
<p>Obviously, this does not have that much practical sense, since we don’t know the future.
However, I was curious how “knowing the future” outperforms passive investing.
In other words this could be in some sense an upper for investment returns.</p>

<h2 id="assumptions">Assumptions</h2>

<p>The world is complex, so let’s make a bunch of assumptions to simplify the problem a bit:</p>

<ul>
  <li>On a given day, only one of the following actions is allowed:
    <ul>
      <li>Buy one position with all your cash at the lowest price available during that day.</li>
      <li>Sell everything at the highest price available that day.</li>
      <li>Do nothing.</li>
    </ul>
  </li>
  <li>Transactions are free.</li>
  <li>One can buy only securities, which are available at 
<a href="https://iextrading.com/developer/docs/#getting-started">IEX</a> (I had to get the data somewhere).</li>
  <li>All transactions succeed no matter what (e.g. volumes are ignored).</li>
  <li>One can buy fractional shares.</li>
</ul>

<p>It may look like holding at most one position at a time is limiting. However, the optimal
trading sequence is like that. Imagine that you bought more than one stock. Then you sold them
and got some profit:</p>
<ul>
  <li>imagine you got the same profit from both. Then you could have bought only
one of them originally and the overall sequence profit would have stayed exactly the same.
In other words, if the first sequence (with more than one stock at a time) is optimal, then
the resulting sequence with at most one stock at a time is also optimal.</li>
  <li>otherwise, one of them brings more profit. Thus, if you buy only this better stock (instead of two stocks),
you will only improve overall sequence profit.</li>
</ul>

<p>That’s a simplistic proof.</p>

<h2 id="results">Results</h2>

<p>Let’s start with the results. This way if you are not interested in all the details,
you don’t have to waste your time going through them.</p>

<p>So, you get 2235976324368894910070981708437303314132384811588503138465677325225209962386423808 USD.
Yeap, for people confused, this is 2.2e+81 USD. 
&lt;here goes a default boring comparison with number of atoms in the universe&gt;.
This is equivalent to 63.93% return on investment, <strong>daily</strong>. 
A lot, right? Penny stocks happened to be very volatile, you know.
And in order to achieve this, you just needed to do 
<a href="/assets/post_resources/luckiest_investor/sequence_with_penny_stocks.html">these 107 transactions</a>.
Easy-peasy.</p>

<p>Obviously, now this feels boring and less exciting than I expected it to be.
Moreover, I feel like buying stocks for 2.2e+81 USD can be tricky these days.
What if we forbid penny stocks? In particular, let’s not buy anything cheaper than 5 USD per share.
Boom, 1537713047211124526310105417510931136512 USD (i.e. 1.5e+39, daily ROI 25.64%,
<a href="/assets/post_resources/luckiest_investor/sequence_without_penny_stocks.html">transactions</a>).</p>

<p>Argh, this is still just some unrealistically large number. And I don’t recognize literally any of these stocks.
Ok, let’s get <em>really conservative</em> here and restrict ourselves to S&amp;P 500 only. 
Buying penny stocks can be tricky to execute, trading volumes can be low, volatility may be too <em>volatile</em>.
So S&amp;P 500, it is. And… <code class="highlighter-rouge">30 853 548 412.13 USD</code> (i.e. 3.1e+10, i.e. just almost 31 billions, ROI 3.1e+09%, daily 4.84%).
So what did you have to do? Just 
<a href="/assets/post_resources/luckiest_investor/sequence_s_p_500.html">these dozen of dozens transactions</a>.</p>

<p>Ok, so this is now much more interesting (at least for me). The number is somewhat realistic
and the first transaction involves AMD, which I know. I declare this a success!</p>

<p>If you are curious, my code is available in
<a href="https://github.com/merelycurious/luckiest-investor-data-analysis">this Github repository</a>.</p>

<h2 id="further-research">Further research</h2>
<p>I am curious to look more into “S&amp;P 500 only” transactions, e.g.
how long each company was in the portfolio, how large their relative impact
on the final result was and so on. However, this post already took 7 hours
and I haven’t even started writing the methodology yet. Moreover,
I decided that I will have breakfast only after finishing this post
and it is 12:03 already and I am starving now. And I have super tasty curry in the fridge,
which I cooked yesterday. Obviously, it was not my original plan to eat curry for breakfast,
but it is also not strictly a breakfast anymore. So I hope you understand me (and curry)
and I may write another post about this some day.</p>

<h2 id="methodology">Methodology</h2>
<p>I am pretty sure you all would love to know how I got the numbers above.</p>

<h3 id="dataset">Dataset</h3>
<p>Obviously, I needed to get daily prices from somewhere, 
so I took them from iextrading.com (<a href="https://iextrading.com/developer/docs/">API docs</a>).
These folks don’t even require registration (i.e. you don’t need an API key),
which is great!</p>

<p>For S&amp;P 500 I just used <a href="https://datahub.io/core/s-and-p-500-companies#data">some random datahub.io csv dataset</a>,
which was built from Wikipedia.</p>

<h3 id="optimization">Optimization</h3>
<p>Once we have the numbers, how do we find the optimal sequence of transactions?</p>

<p>The key observation here is that if we have X shares of a given stock Y on day
Z, then we don’t care at all how we arrived in this state. E.g. we could have bought
them yesterday or 1 week ago, but this has zero effect on the final outcome 
(i.e. amount of money we have in the end).</p>

<p>This allows us to apply so-called dynamic programming. Basically for each day of
2018 and each available stock 
we want to calculate the maximum amount of that stock we could have had.
I.e. <code class="highlighter-rouge">best_quantity[2018-03-14][APPL]</code> is a maximal number of APPL stock
we could have had on Pi day in 2018 (i.e. by doing optimal transactions before).</p>

<p>According to the problem definition, we know that <code class="highlighter-rouge">best_quantity[2017-12-31][$]</code> is 1000
and <code class="highlighter-rouge">best_quantity[2017-12-31][&lt;any stock&gt;]</code> is 0 (we have 1000 USD and no stocks
at the beginning).</p>

<p>Then we can notice that we can calculate <code class="highlighter-rouge">best_quantity[&lt;date&gt; + 1]</code> if we know
<code class="highlighter-rouge">best_quantity[&lt;date&gt;]</code>. If we are in a some state on some date, there are only
3 actions we can perform:</p>

<ul>
  <li>hold what we have</li>
  <li>if we have cash, buy something</li>
  <li>if we have something, sell and get cash.</li>
</ul>

<p>Thus, we can just go over all states, try to perform the action and see whether
this improves the result for the new state. For example, buying stock X means:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>best_quantity[&lt;date&gt; + 1][&lt;stock X&gt;] = 
	max(best_quantity[&lt;date&gt; + 1][&lt;stock X&gt;],
	    best_quantity[&lt;date&gt;][$] / &lt;price of X on &lt;date + 1&gt;&gt;)
</code></pre></div></div>
<p>In other words, imagine that you have <code class="highlighter-rouge">best_quantity[&lt;date&gt;][$]</code> USD on the day <code class="highlighter-rouge">&lt;date&gt;</code> (evening)
and you want to buy <code class="highlighter-rouge">&lt;stock X&gt;</code>. You can do this by waiting until tomorrow, i.e. <code class="highlighter-rouge">&lt;date + 1&gt;</code>
and just buying that stock according to the current price. Why do we have <code class="highlighter-rouge">max</code>?
Because there may be other better ways to get more of this stock (e.g. by buying it earlier
at a cheaper price and just holding).</p>

<p>By doing this for each date and each symbol, we get our final answer in 
<code class="highlighter-rouge">best_quantity[2018-12-31][$]</code>.</p>

<p>How to get the actual optimal sequence of transactions? Each time some <code class="highlighter-rouge">best_quantity</code> is improved,
we can just save which action has led to this improvement (i.e. from which state
we got there). Using this information, we can easily see how we got to <code class="highlighter-rouge">best_quantity[2018-12-31][$]</code> and 
go to the previous state. And then just repeat this process of going backwards, until we reach our initial state
of having 1000 USD. Once we know 2 adjacent states, reverse engineering which action it was is trivial.</p>

<h3 id="issues">Issues</h3>

<p>Obviously, this wasn’t as smooth as I expected (and I have to explain spending at least 7 hours on this).</p>

<h3 id="noisy-data">Noisy data</h3>
<p>Mostly the issue was with weird prices in the data.</p>

<p>Basically, my first attempts returned something like 10^124 USD, which was
somewhat larger than I expected. After inspecting the proposed sequence of stocks,
I discovered some very lucrative transactions, e.g.:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2018-05-30 buy ZAZZT 7.87048936311242e+47 @ 0.9  
2018-05-31 sell ZAZZT 8.185301067147553e+52 @ 103999.9  ROI = 115554.44444444444
</code></pre></div></div>

<p>and in the data it was</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ['2018-05-29', None, None, None, 0.9],
 ['2018-05-30', None, None, None, 0.9],
 ['2018-05-31', 87359.95, 103999.9, 103999.9, 87359.95],
 ['2018-06-01', None, None, None, 87359.95],
 ['2018-06-04', None, None, None, 87359.95],
</code></pre></div></div>
<p>which looked very fishy, so I just dropped all price points where at least one value was missing
(i.e. 35098 price points out of 1962200, i.e. 1.7% - yeah, I was worried to drop too much, so I checked
the percentage).</p>

<p>This brought the result down to $10^115. This time the transactions were less awkward, but still odd.
Example culprit:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2018-02-12 buy ZWZZT 2.5002156249822376e+16 @ 12.5  
2018-02-14 sell ZWZZT 1.600121998608632e+21 @ 63999.36  ROI = 5118.9488
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ['2018-02-09', None, None, None, 18.1],
 ['2018-02-12', 12.5, 12.5, 12.5, 12.5],
 ['2018-02-13', None, None, None, 12.5],
 ['2018-02-14', 5, 63999.36, 63999.36, 5],
 ['2018-02-15', None, None, None, 5],
</code></pre></div></div>

<p>Looks like an outlier.
Thus, let’s kick out price points with all 4 values being the same
(65112 out of 1927102) and with max-min ratio larger than 10 (20 points out of 
remaining 1861990).</p>

<p>This gets us down to $10^84.
The only suspiciously large ROI now was</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2018-10-04 buy ZXZZT 5.209604829132704e+61 @ 10.86  
2018-10-10 sell ZXZZT 6.338984640830725e+66 @ 121678.8  ROI = 11203.309392265193
</code></pre></div></div>

<p>Fighting this one was not obvious, so I started looking at trading volumes as well:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ['2018-10-03', 100, None, None, None, 10],
 ['2018-10-04', 1200, 10.86, 11, 11, 10.86],
 ['2018-10-05', 100, None, None, None, 10.86],
 ['2018-10-08', 835, 0.0072, 0.0072, 0.0072, 0.0072],
 ['2018-10-09', 800, 168998.31, 168998.31, 168998.31, 168998.31],
 ['2018-10-10', 400, 121678.79, 121678.8, 121678.79, 121678.8],
 ['2018-10-11', 100, None, None, None, 121678.8],
 ['2018-10-12', 300, 115198.85, 127998.72, 127998.72, 115198.85],
 ['2018-10-15', 400, 99999.9, 100000, 100000, 99999.9],
</code></pre></div></div>

<p>For simplicity I just removed all price points with less than 1000 trading volume
(51610 out of remaining 1861970).</p>

<p>This gave 2.235976324368895e+81, which you have already seen above.</p>

<h3 id="penny-stocks">Penny stocks</h3>

<p>After morally accepting that number, I noticed that majority of the transactions are just penny stocks anyway, 
which is not that interesting (they are volatile as crazy). So I just stopped “buying” anything cheaper than $5 per share.
I know that not all of these are penny stocks, but this affects only 226071 price points
(and I am hungry, remember the curry), so the limit is $5.</p>

<p>This brought us down to 1.5377130472111245e+39 USD, which still didn’t feel completely satisfying.
So that’s how I started limiting stocks to S&amp;P 500.</p>

<p>And now I am going to finally eat my curry (“Hooray!” says my stomach).</p>

  </div><a class="u-url" href="/post/luckiest-investor-or-investing-when-knowing-the-future" hidden></a>
</article>

      </div>
    </main>
<footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">
    
    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Merely curious</li><li><a class="u-email" href="mailto:merelycurious protonmail.com">merelycurious protonmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://www.twitter.com/merely_curious_"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">merely_curious_</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Everything I find interesting enough.</p>
      </div>
    </div>

  </div>

</footer>

<script type="text/javascript" async src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML'></script>

</body>

</html>
